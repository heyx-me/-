# Phase 9 Plan: Layout Shell & Mobile Navigation

## Goal
Establish a robust, responsive "Master-Detail" shell with query-parameter routing and mobile-native transitions.

## 1. Component Refactoring (Preparation)
Currently, `app.jsx` is large. We will extract core sections to prepare for the new layout.
- [ ] **Extract `ConversationList`**: Move the list logic from the `Sidebar` modal into a standalone component that can live in the main layout.
- [ ] **Extract `ChatHeader` & `SidebarHeader`**: Create these distinct components to replace the current single global header.

## 2. Router & State Management
- [ ] **Implement `useRouter` Hook**:
    - Listen to `popstate`.
    - Parse `?v=` and `?id=`.
    - Provide `navigate(view, params)` function.
- [ ] **State Logic**:
    - `view`: 'list' | 'chat'
    - `activeChatId`: UUID | null
    - `isMobile`: boolean (via `window.matchMedia`)

## 3. Shell Implementation (The "Skeleton")
- [ ] **Create `Layout` Component**:
    - **Desktop (>=768px):** Two columns. Left fixed width (350px), Right fluid. Both always visible.
    - **Mobile (<768px):** Single column container.
- [ ] **Implement Mobile View Switching**:
    - If `view === 'list'`, show `ConversationList`.
    - If `view === 'chat'`, show `ChatInterface`.
- [ ] **Empty State (Desktop)**:
    - Create a `Placeholder` component (simple graphic + text) to show in the Right pane when `activeChatId` is null.

## 4. Navigation Logic
- [ ] **List -> Chat**:
    - Clicking a conversation item calls `navigate('chat', { id: ... })`.
    - Updates URL to `?v=chat&id=...`.
- [ ] **Chat -> List (Mobile)**:
    - "Back" button in `ChatHeader` calls `navigate('list')`.
    - Updates URL to `?v=list`.
- [ ] **Deep Linking**:
    - On load, if URL has `?v=chat&id=...`, automatically select that chat and show the chat view.

## 5. Visuals & Transitions (Polish)
- [ ] **Mobile Transitions**:
    - Wrap the mobile content switch in `<AnimatePresence>`.
    - Slide List to Left (-100%) when entering Chat.
    - Slide Chat from Right (+100%) when entering.
    - Reverse on Back.
- [ ] **Scroll Restoration**:
    - Ensure the List remembers its scroll position when returning from Chat on mobile. (Start with simple CSS hiding if performance allows, otherwise use a Ref to save/restore scrollTop).

## 6. Verification
- [ ] **Mobile Test**: Verify navigation flow, back button, and slide animations.
- [ ] **Desktop Test**: Verify split view, resizing behavior, and deep linking.
- [ ] **Browser Back**: Verify browser back button works as expected.
