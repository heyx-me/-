# Phase 10 Plan: Contacts & Sidebar

## Goal
Implement a tabbed sidebar with a Contacts list (Apps) and logic to jump to existing threads or create new ones.

## 1. Database Migration (Preparation)
- [ ] **Add `app_id` column to `conversations`**:
    - Run a script to `ALTER TABLE conversations ADD COLUMN app_id TEXT`.
    - This allows us to link a conversation to a specific app (e.g., 'rafi', 'nanie') at the conversation level, not just the message level.

## 2. UI Refactoring: Sidebar Tabs
- [ ] **Create `SidebarTabs` Component**:
    - Two tabs: "Chats" and "Contacts".
    - Active state styling.
- [ ] **Update `App` State**:
    - `sidebarTab`: 'chats' | 'contacts'.
    - `useEffect` to set `sidebarTab` to 'contacts' if `conversations.length === 0` on initial load.
- [ ] **Update Sidebar Layout**:
    - Replace the "New Chat" button area with the `SidebarTabs`.

## 3. Contacts List Implementation
- [ ] **Create `ContactsList` Component**:
    - Map through `apps.json`.
    - Render each app with its icon and name.
    - Handle empty state with a centered generic placeholder.
- [ ] **Integrate into Sidebar**:
    - Conditionally render `ConversationList` or `ContactsList` based on `sidebarTab`.

## 4. Navigation & Thread Logic
- [ ] **Update `handleSelectContact`**:
    - Search local `conversations` (from context) for the most recent one where `app_id === selectedApp.id`.
    - If found: `navigate('chat', { id: found.id })`.
    - If not found:
        - Create a new conversation in Supabase with `app_id` set.
        - `navigate('chat', { id: newId })`.
- [ ] **Update `sendMessage` logic in `ChatInterface`**:
    - Ensure when creating a "Lazy" conversation, it also sets the `app_id` if an `activeApp` is present.

## 5. Chat Header: Action Menu
- [ ] **Update `ChatHeader`**:
    - Add a "More" (3-dots) button.
    - Implement a simple dropdown/menu.
    - Menu Item: **"New Thread"** -> Forces creation of a new conversation with the current `activeApp.id` and navigates to it.

## 6. Verification
- [ ] **Empty State**: Verify sidebar starts on Contacts if no chats exist.
- [ ] **Jump Logic**: Verify clicking a contact opens the last chat with that app.
- [ ] **Multiple Threads**: Verify "New Thread" in header creates a second distinct chat for the same app.
- [ ] **Responsive**: Ensure tabs and lists work well on mobile.
