# Phase 11 Plan: Preview Overlay & Polish

## Goal
Implement the "App View" (Preview) with overlay chat capabilities, layout polish, and richer list data.

## 1. Data Layer (Last Message)
- [ ] **Update `fetchConversations`**:
    - Modify query: `.select('*, messages(content, created_at)')`.
    - Order messages by `created_at` descending, limit 1.
- [ ] **Update `ConversationList`**:
    - Display `last_message.content` instead of hardcoded text.
    - Format timestamp relative to now (e.g., "10:00 AM", "Yesterday").

## 2. Component Decomposition
- [ ] **Extract `ChatInput`**: Standalone component taking `onSend`.
- [ ] **Extract `MessageList`**: Standalone component rendering the history.
- [ ] **Extract `ChatToasts`**: Standalone component for the overlay bubbles logic (AnimatePresence).

## 3. View Architecture
- [ ] **Create `ChatView`**:
    - Layout: `Header` -> `MessageList` -> `ChatInput`.
- [ ] **Create `AppView`**:
    - Layout: `Header` -> `div(relative flex-1)` -> `ChatInput`.
    - Inside `div`: `PreviewPane` (Iframe) + `ChatToasts` (Absolute).
- [ ] **Update `App.jsx`**:
    - Add `viewMode` state ('chat' | 'app').
    - Toggle button in `ChatHeader` switches this state.
    - Render `ChatView` or `AppView` based on state.

## 4. Layout Polish
- [ ] **Fix Overflow**: Ensure `min-h-0` is applied to flex parents of scrolling lists.
- [ ] **Input Pinning**: Verify input stays visible on mobile keyboards (though standard sticky might be enough for this web app phase).

## 5. Verification
- [ ] **Data**: Check list shows actual last message.
- [ ] **Toggle**: Check switching between Chat and App views works.
- [ ] **Interaction**: Check sending messages from App View (Input) works and Toasts appear.
- [ ] **Layout**: resizing window doesn't break the flex layout.
