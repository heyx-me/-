# Phase 14 Plan: Integration & Linking

## Goal
Implement the `SELECT_GROUP` action to complete the linking process.

## Steps

### 1. Backend: SELECT_GROUP Handler (TDD)
- [ ] **Update `nanie/agent.test.js`:**
    - Test `SELECT_GROUP` action:
        - Verify `setMapping` is called.
        - Verify `DATA` is broadcasted.
        - Verify `STATUS: LINKED` is returned.
- [ ] **Update `nanie/agent.mjs`:**
    - Implement `action: 'SELECT_GROUP'` in `handleMessage`.
    - Validate group visibility via `store`.
    - Update mapping.
    - Trigger timeline update.

### 2. Frontend: Linking Logic
- [ ] **Update `nanie/app.jsx`:**
    - Implement `handleSelectGroup`:
        - Optimistically switch to chat view.
        - Update Conversation Title (Smart Rename).
        - Send `SELECT_GROUP` message.
        - Handle errors (revert view if failed).

## Verification
1.  **Backend Test:** `npm test nanie/agent.test.js`.
2.  **Manual Test:**
    - Open App (Unlinked state).
    - See Group List.
    - Click a Group.
    - Verify:
        - View switches to Chat.
        - "Connecting..." or similar feedback.
        - Events appear (History loaded).
        - Conversation Title changes (in Supabase/UI).
